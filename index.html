<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <!-- iPhone WebApp full screen -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Hydra">
  <title>Hydra â€” Suivi dâ€™eau</title>
  <style>
    :root{
      --bg1:#051219; --bg2:#020a0f; --panel:#0a1620; --panel2:#07111a; --text:#e9f6ff; --muted:#9dc0d9; --accent:#7be0ff; --accent2:#5cffc5; --warn:#ffd166; --danger:#ff6d83; --ok:#9bff9b; --border:#123041;
      --glass:#0f2a36; --fill1:#0cb6ff; --fill2:#10e0c8; --bubble:rgba(160,235,255,.85);
      --radius:20px; --shadow:0 18px 40px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.04);
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:radial-gradient(1200px 900px at 50% -20%, #07233a 0%, var(--bg1) 45%, var(--bg2) 100%);color:var(--text);font-family:System-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,'Noto Sans',sans-serif;overflow:hidden;-webkit-tap-highlight-color:transparent}

    /* Layout */
    .app{position:relative;max-width:460px;margin:0 auto;height:100dvh;display:grid;grid-template-rows:auto 1fr auto;gap:12px;padding:14px}
    header{display:flex;align-items:center;justify-content:space-between;background:linear-gradient(180deg,#0e1e2a,#09141d);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);padding:10px 12px}
    .title{display:flex;align-items:center;gap:10px;font-weight:900;letter-spacing:.4px}
    .badge{font-size:12px;border:1px solid var(--border);background:#0d1b26;color:var(--muted);padding:6px 8px;border-radius:999px}
    .stats{display:flex;gap:10px;flex-wrap:wrap;color:var(--muted);font-size:13px}
    .chip{border:1px solid var(--border);background:#0e1c26;border-radius:999px;padding:6px 8px}

    main{position:relative;display:grid;grid-template-rows:1fr auto;gap:12px}
    .card{background:linear-gradient(180deg,var(--panel),var(--panel2));border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:14px}

    /* Bouteille */
    .bottleWrap{position:relative;height:100%;display:grid;place-items:center;overflow:hidden}
    .bottle{position:relative;width:min(72vw,320px);aspect-ratio:3/5;filter:drop-shadow(0 18px 40px rgba(12,182,255,.15))}
    .bottle svg{width:100%;height:100%;display:block}
    .water{position:absolute;left:8%;right:8%;bottom:10%;height:0;border-radius:0 0 22px 22px;background:linear-gradient(180deg,var(--fill1),var(--fill2));box-shadow:inset 0 6px 16px rgba(255,255,255,.25);overflow:hidden}
    .water::after{content:"";position:absolute;inset:0;background:radial-gradient(120px 20px at 50% 12px, rgba(255,255,255,.28), transparent 60%), repeating-linear-gradient( -35deg, rgba(255,255,255,.08) 0 8px, rgba(255,255,255,0) 8px 16px );opacity:.8;mix-blend-mode:screen}
    .surface{position:absolute;left:8%;right:8%;bottom:calc(10% + var(--h));height:16px;border-radius:999px;background:linear-gradient(180deg, rgba(255,255,255,.6), rgba(255,255,255,.05));filter:blur(0.2px);box-shadow:0 6px 18px rgba(16,224,200,.25)}
    .bubble{position:absolute;width:8px;height:8px;border-radius:999px;background:var(--bubble);opacity:.9;animation:rise 4s linear infinite}
    @keyframes rise{ from{ transform:translateY(0) scale(.8) } to{ transform:translateY(-180px) scale(1)} }

    /* Historique */
    .history{display:grid;grid-template-columns:repeat(7,1fr);gap:10px}
    .bar{height:76px;background:linear-gradient(180deg,#0c1a26,#0a131d);border:1px solid var(--border);border-radius:12px;position:relative;overflow:hidden}
    .bar > div{position:absolute;left:0;right:0;bottom:0;height:0;background:linear-gradient(180deg,var(--fill1),var(--fill2))}
    .bar label{position:absolute;left:50%;bottom:-22px;transform:translateX(-50%);font-size:11px;color:var(--muted)}

    /* Boutons */
    .dock{display:flex;gap:12px;justify-content:space-between}
    .big{flex:1;display:grid;place-items:center;height:64px;border:1px solid var(--border);border-radius:16px;background:linear-gradient(180deg,#163149,#0d1b2a);box-shadow:var(--shadow);font-weight:900;font-size:20px}
    .big:active{transform:translateY(1px)}
    .round{width:64px;height:64px;border-radius:999px;border:1px solid var(--border);background:linear-gradient(180deg,#1d3e59,#102232);display:grid;place-items:center;font-weight:900}

    .ghost{background:transparent;border:1px dashed var(--border)}

    .toast{position:fixed;left:50%;bottom:22px;transform:translateX(-50%);background:rgba(8,14,22,.9);border:1px solid var(--border);border-radius:12px;padding:8px 12px;display:none;z-index:20}
    .toast.show{display:block}

    /* Modales */
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:30;padding:16px}
    .modal{max-width:420px;width:100%;background:linear-gradient(180deg,#0e1e2a,#0a141d);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);padding:14px}
    .modal h3{margin:4px 0 8px}
    .field{display:flex;align-items:center;justify-content:space-between;border:1px solid var(--border);background:#0c1822;border-radius:12px;padding:10px;margin:8px 0}
    .field input{background:transparent;border:none;color:var(--text);text-align:right;width:90px;font-size:16px;outline:none}

    .link{color:var(--accent)}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="title"><span style="font-size:20px">ðŸ’§</span> Hydra <span class="badge">iPhone WebApp</span></div>
      <div class="stats">
        <span class="chip">Objectif: <b id="goalLbl">2000</b> ml</span>
        <span class="chip">Aujourdâ€™hui: <b id="todayLbl">0</b> ml</span>
        <span class="chip">Restant: <b id="leftLbl">2000</b> ml</span>
      </div>
    </header>

    <main>
      <section class="card bottleWrap">
        <div class="bottle">
          <!-- Bouteille (SVG) -->
          <svg viewBox="0 0 300 500" aria-hidden="true">
            <defs>
              <linearGradient id="glassGrad" x1="0" x2="0" y1="0" y2="1">
                <stop offset="0%" stop-color="#3be7ff" stop-opacity=".25"/>
                <stop offset="50%" stop-color="#3be7ff" stop-opacity=".08"/>
                <stop offset="100%" stop-color="#3be7ff" stop-opacity=".18"/>
              </linearGradient>
            </defs>
            <path d="M110 30 h80 a12 12 0 0 1 12 12 v24 a12 12 0 0 1 -12 12 h-80 a12 12 0 0 1 -12 -12 v-24 a12 12 0 0 1 12 -12 z" fill="#0f2a36"/>
            <path d="M80 78 h140 v14 a18 18 0 0 1 -18 18 h-104 a18 18 0 0 1 -18 -18 z" fill="#103144"/>
            <path d="M70 110 q-22 40 -22 70 v240 q0 40 30 50 l60 18 q16 5 32 0 l60 -18 q30 -9 30 -50 V180 q0 -30 -22 -70 z" fill="url(#glassGrad)" stroke="#1c485e" stroke-width="2"/>
          </svg>
          <div class="water" id="water"></div>
          <div class="surface" id="surface" style="--h:0px"></div>
        </div>
      </section>

      <section class="card">
        <div class="history" id="history"></div>
      </section>
    </main>

    <nav class="dock">
      <button class="round" id="btnMinus">âˆ’</button>
      <button class="big" id="btnAdd">+ Ajouter <span id="cupLbl" style="font-size:14px;font-weight:700;color:var(--muted)">(250 ml)</span></button>
      <button class="round" id="btnSettings">âš™ï¸Ž</button>
    </nav>
  </div>

  <!-- Modale RÃ©glages -->
  <div class="overlay" id="ov">
    <div class="modal">
      <button class="link" id="btnClose" style="float:right">âœ• Fermer</button>
      <h3>RÃ©glages</h3>
      <div class="field"><span>Taille dâ€™un verre</span><input id="cupInput" type="number" step="50" min="50" value="250"> ml</div>
      <div class="field"><span>Objectif quotidien</span><input id="goalInput" type="number" step="100" min="500" value="2000"> ml</div>
      <div class="field"><span>RÃ©initialiser aujourdâ€™hui</span><button class="link" id="btnReset">Remettre Ã  0</button></div>
      <div class="field"><span>Exporter historique</span><button class="link" id="btnExport">JSON</button></div>
      <div class="field"><span>Importer historique</span><button class="link" id="btnImport">JSON</button></div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

<script>
// ===== Helpers
const $ = s=>document.querySelector(s);
const todayKey = ()=> new Date().toISOString().slice(0,10);
const fmt = new Intl.NumberFormat('fr-FR');
function toast(m){ const t=$('#toast'); t.textContent=m; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),1100); }
function clamp(v,a,b){ return Math.max(a,Math.min(b,v)); }

// ===== State
const KEY='hydra.v1';
let state = { goal:2000, cup:250, days:{} }; // days: { 'YYYY-MM-DD': amount_ml }

function save(){ localStorage.setItem(KEY, JSON.stringify(state)); }
function load(){ try{ const s=JSON.parse(localStorage.getItem(KEY)||'null'); if(s) state=s; }catch{} }

// Seed
load(); state.days ||= {}; state.goal ||= 2000; state.cup ||= 250;
if(!state.days[todayKey()]) state.days[todayKey()] = 0;

// ===== UI Update
function setWaterLevel(){
  const cur = state.days[todayKey()]||0; const r = clamp(cur/state.goal,0,1);
  const bottle = document.querySelector('.bottle');
  const water = $('#water');
  const h = Math.round((bottle.clientHeight*0.70) * r); // ~70% of bottle height
  water.style.height = h+'px';
  $('#surface').style.setProperty('--h', h+'px');
  $('#todayLbl').textContent = fmt.format(cur);
  $('#goalLbl').textContent  = fmt.format(state.goal);
  $('#leftLbl').textContent  = fmt.format(Math.max(0, state.goal-cur));
}

function renderHistory(){
  const wrap = $('#history'); wrap.innerHTML='';
  const days = [];
  const d0 = new Date();
  for(let i=6;i>=0;i--){ const d=new Date(d0); d.setDate(d0.getDate()-i); const k=d.toISOString().slice(0,10); days.push(k); }
  for(const k of days){
    const v = state.days[k]||0; const r=clamp(v/state.goal,0,1);
    const bar = document.createElement('div'); bar.className='bar';
    const fill = document.createElement('div'); fill.style.height = Math.round(r*100)+'%';
    const lab = document.createElement('label'); const dd = new Date(k); lab.textContent = dd.toLocaleDateString('fr-FR',{weekday:'short'}).replace('.','');
    bar.appendChild(fill); bar.appendChild(lab); wrap.appendChild(bar);
  }
}

function spawnBubbles(){
  const water = $('#water'); if(!water) return; for(let i=0;i<8;i++){
    const b = document.createElement('div'); b.className='bubble';
    b.style.left = (10 + Math.random()*80)+'%'; b.style.bottom='8px'; b.style.animationDuration = (3+Math.random()*2)+'s'; b.style.opacity = .5 + Math.random()*0.4;
    water.appendChild(b); setTimeout(()=> b.remove(), 4500);
  }
}

function confetti(){
  const N=80; for(let i=0;i<N;i++){
    const s=document.createElement('div'); s.style.position='fixed'; s.style.width='6px'; s.style.height='10px'; s.style.left=(Math.random()*100)+'%'; s.style.top='-10px'; s.style.background=`hsl(${Math.random()*200+160},90%,60%)`;
    s.style.transform=`rotate(${Math.random()*360}deg)`; s.style.transition='transform 1.2s ease, top 1.2s ease, opacity 1.2s ease'; s.style.zIndex='9999'; document.body.appendChild(s);
    const tx=(Math.random()*2-1)*120; const ty=window.innerHeight+20; const rot=(Math.random()*360);
    requestAnimationFrame(()=>{ s.style.top=ty+'px'; s.style.transform=`translate(${tx}px,0) rotate(${rot}deg)`; s.style.opacity='0'; });
    setTimeout(()=>s.remove(),1400);
  }
}

function renderAll(){ setWaterLevel(); renderHistory(); $('#cupLbl').textContent = `(${state.cup} ml)`; }

// ===== Actions
function add(amount){ const k=todayKey(); state.days[k] = (state.days[k]||0) + amount; save(); renderAll(); spawnBubbles(); if(state.days[k]>=state.goal && (state.days[k]-amount)<state.goal){ toast('Objectif atteint ! ðŸ’§'); confetti(); } }
function remove(amount){ const k=todayKey(); state.days[k] = clamp((state.days[k]||0) - amount, 0, 100000); save(); renderAll(); }
function resetToday(){ const k=todayKey(); state.days[k]=0; save(); renderAll(); }

// ===== Events
$('#btnAdd').onclick = ()=> add(state.cup);
$('#btnMinus').onclick = ()=> remove(state.cup);
$('#btnSettings').onclick = ()=> $('#ov').style.display='flex';
$('#btnClose').onclick = ()=> $('#ov').style.display='none';
$('#btnReset').onclick = ()=>{ if(confirm('Remettre Ã  0 la journÃ©e ?')) resetToday(); };

$('#cupInput').value = state.cup; $('#goalInput').value = state.goal;
$('#cupInput').onchange = (e)=>{ const v=+e.target.value||250; state.cup = clamp(v,50,2000); save(); renderAll(); toast('Verre mis Ã  jour'); };
$('#goalInput').onchange = (e)=>{ const v=+e.target.value||2000; state.goal = clamp(v,500,10000); save(); renderAll(); toast('Objectif mis Ã  jour'); };

// Export / Import
$('#btnExport').onclick = ()=>{
  const blob = new Blob([JSON.stringify(state,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='hydra.json'; a.click(); URL.revokeObjectURL(url);
};
$('#btnImport').onclick = ()=>{
  const inp=document.createElement('input'); inp.type='file'; inp.accept='.json,application/json';
  inp.onchange = ()=>{ const f=inp.files[0]; if(!f) return; const r=new FileReader(); r.onload=()=>{ try{ const s=JSON.parse(r.result); if(s && s.days && s.goal && s.cup){ state=s; save(); renderAll(); toast('Import rÃ©ussi'); } else toast('Fichier invalide'); }catch{ toast('Erreur import'); } }; r.readAsText(f); };
  inp.click();
};

// ===== Init
renderAll();
setInterval(spawnBubbles, 2500);
</script>
</body>
</html>
